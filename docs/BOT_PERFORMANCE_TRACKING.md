# Bot Performance Tracking - Automated Paper Trading System

## Overview

This system automatically creates paper trades for **every signal** generated by your bot and displays the results on a **public dashboard** that anyone can access without logging in. This allows you to demonstrate your bot's accuracy and performance to potential users.

## How It Works

### 1. Automatic Signal Paper Trading

Every time your bot generates a new signal:

1. **Signal Created** ‚Üí A new `Signal` instance is saved in the database
2. **Signal Handler Triggered** ‚Üí Django signal handler `create_system_paper_trade()` is automatically called
3. **System Paper Trade Created** ‚Üí A paper trade with `user=null` (system-wide) is created with:
   - Fixed position size: $100
   - Entry price from the signal
   - Take profit and stop loss from the signal
   - Linked to the original signal

### 2. Trade Management

The paper trading service automatically manages these trades:

- **Entry**: Trade is created as soon as signal is ACTIVE
- **Monitoring**: Celery tasks monitor price movements
- **Exit**: Automatically closes when TP or SL is hit
- **Status Updates**: Trade status updates in real-time

### 3. Public Dashboard

A public-facing dashboard displays:

- Total P/L across all paper trades
- Win rate and statistics
- Open positions with real-time prices
- Trade history
- Performance metrics

**Accessible at**: `http://localhost:5173/bot-performance` (no login required)

## Implementation Details

### Backend Changes

#### 1. Signal Handler ([signals_handlers.py:188-236](backend/signals/signals_handlers.py#L188-L236))

```python
@receiver(post_save, sender=Signal)
def create_system_paper_trade(sender, instance, created, **kwargs):
    """
    Automatically create a SYSTEM-WIDE paper trade for every signal.

    - Creates paper trade with user=None (system-wide)
    - Fixed position size of $100 per trade
    - Only executes on new ACTIVE signals
    - Results displayed on public dashboard
    """
    if not created or instance.status != 'ACTIVE':
        return

    try:
        from .services.paper_trader import paper_trading_service

        trade = paper_trading_service.create_paper_trade(
            signal=instance,
            user=None,  # System-wide trade
            position_size=100.0  # Fixed $100 per trade
        )

        logger.info(
            f"ü§ñ System paper trade created: {trade.direction} {trade.symbol} "
            f"@ {trade.entry_price} (Trade ID: {trade.id}, Signal ID: {instance.id})"
        )
    except Exception as e:
        logger.error(
            f"‚ùå Failed to create system paper trade for signal {instance.id}: {e}",
            exc_info=True
        )
```

#### 2. Public API Endpoints (Already Exist)

These endpoints are already available and require NO authentication:

- `GET /api/public/paper-trading/` - List all system paper trades
- `GET /api/public/paper-trading/summary/` - Performance summary
- `GET /api/public/paper-trading/open-positions/` - Current open positions with real-time prices
- `GET /api/public/paper-trading/performance/` - Detailed performance metrics

### Frontend Changes

#### 1. Bot Performance Page ([BotPerformance.jsx](client/src/pages/BotPerformance.jsx))

A comprehensive public dashboard featuring:

**Performance Metrics Display:**
- Total P/L
- Win Rate (W/L ratio)
- Open Positions Count
- Average Profit per winning trade
- Average Loss per losing trade
- Total Signals tracked

**Three Tabs:**
1. **Overview** - Summary of open positions and recent trades
2. **Open Positions** - All currently active trades with real-time P/L
3. **Trade History** - Complete history of closed trades

**Real-time Updates:**
- Auto-refreshes every 30 seconds
- No authentication required
- Real-time price fetching from Binance API

#### 2. Routing ([AppRouter.jsx:29-33](client/src/routes/AppRouter.jsx#L29-L33))

Public route added:

```javascript
<Route path="/bot-performance" element={
  <ErrorBoundary>
    <BotPerformance />
  </ErrorBoundary>
} />
```

#### 3. Navigation ([Layout.jsx:60-65](client/src/components/layout/Layout.jsx#L60-L65))

Link added to main navigation:

```javascript
<Link to="/bot-performance" className="...">
  Bot Performance
</Link>
```

## Usage

### For Administrators

**To view your bot's performance:**

1. Navigate to `http://localhost:5173/bot-performance`
2. No login required - this is a public page
3. View real-time statistics and trade history

**The system automatically:**
- Creates paper trades for every signal
- Monitors positions and closes them at TP/SL
- Updates statistics in real-time
- Shows performance to visitors

### For Visitors/Users

**Share this URL with potential users:**

```
http://your-domain.com/bot-performance
```

This page shows:
- Your bot's actual performance
- Real trades based on real signals
- Transparent win/loss history
- Current open positions

## Data Flow

```
Signal Generated
    ‚Üì
Signal Saved to DB (status=ACTIVE)
    ‚Üì
Django Signal Handler: create_system_paper_trade()
    ‚Üì
Paper Trade Created (user=null, position_size=$100)
    ‚Üì
Celery Tasks Monitor Price
    ‚Üì
TP/SL Hit ‚Üí Trade Closed
    ‚Üì
Statistics Updated
    ‚Üì
Displayed on Public Dashboard
```

## Key Features

### 1. Transparent Performance

- Every signal is tracked automatically
- No manual intervention
- Real profit/loss calculations
- Honest win/loss ratio

### 2. Public Access

- No login required to view
- Share with anyone
- Build trust with potential users
- Demonstrate bot accuracy

### 3. Real-time Updates

- Live price fetching from Binance
- Automatic position monitoring
- Real-time P/L calculations
- 30-second refresh interval

### 4. System-wide Tracking

- All signals from all market types (SPOT/FUTURES)
- Fixed $100 position size per trade
- Consistent entry/exit logic
- Comprehensive statistics

## Configuration

### Customizing Position Size

To change the default $100 position size, edit [signals_handlers.py:224](backend/signals/signals_handlers.py#L224):

```python
trade = paper_trading_service.create_paper_trade(
    signal=instance,
    user=None,
    position_size=100.0  # Change this value
)
```

### Filtering Signals

To only track certain types of signals, modify the handler condition at line 212:

```python
# Only track FUTURES signals
if instance.market_type != 'FUTURES':
    return

# Only track high-confidence signals
if instance.confidence < 0.8:
    return
```

## Monitoring

### Backend Logs

Watch for automatic paper trade creation:

```bash
docker-compose logs -f backend | grep "System paper trade"
```

You should see:
```
ü§ñ System paper trade created: LONG BTCUSDT @ 42500.50 (Trade ID: 123, Signal ID: 456)
```

### Database Queries

Check system paper trades:

```sql
-- All system paper trades (user is null)
SELECT * FROM paper_trades WHERE user_id IS NULL;

-- Open system positions
SELECT * FROM paper_trades WHERE user_id IS NULL AND status = 'OPEN';

-- System performance
SELECT
    COUNT(*) as total_trades,
    SUM(CASE WHEN status LIKE 'CLOSED_TP' THEN 1 ELSE 0 END) as wins,
    SUM(CASE WHEN status LIKE 'CLOSED_SL' THEN 1 ELSE 0 END) as losses,
    AVG(realized_pnl) as avg_pnl
FROM paper_trades
WHERE user_id IS NULL AND status LIKE 'CLOSED%';
```

## Troubleshooting

### Paper Trades Not Being Created

1. **Check signal status**: Only ACTIVE signals trigger paper trades
   ```python
   # In Django shell
   from signals.models import Signal
   Signal.objects.filter(status='ACTIVE').count()
   ```

2. **Check signal handler is registered**:
   ```python
   # In Django shell
   from django.db.models.signals import post_save
   from signals.models import Signal
   post_save._live_receivers(Signal)
   ```

3. **Check backend logs**:
   ```bash
   docker-compose logs backend | grep "System paper trade"
   ```

### Dashboard Not Loading

1. **Check API endpoints**:
   ```bash
   curl http://localhost:8000/api/public/paper-trading/summary/
   ```

2. **Check frontend is running**:
   ```bash
   docker-compose ps frontend
   ```

3. **Check browser console** for errors

### Real-time Prices Not Showing

1. **Check Binance API connection**:
   ```python
   # In Django shell
   from signals.services.binance_client import BinanceClient
   import asyncio

   client = BinanceClient()
   loop = asyncio.new_event_loop()
   price = loop.run_until_complete(client.get_price('BTCUSDT'))
   print(price)
   ```

2. **Check network connectivity** from backend container

## Statistics Calculation

The public summary endpoint calculates:

- **Total P/L**: Sum of all realized P/L from closed trades
- **Win Rate**: (Winning trades / Total closed trades) √ó 100
- **Average Profit**: Average P/L of winning trades only
- **Average Loss**: Average P/L of losing trades only
- **Total Trades**: Count of all paper trades (open + closed)
- **Open Positions**: Count of trades with status='OPEN'

## Security Notes

- Public API endpoints use `AllowAny` permission
- Only READ operations are allowed publicly
- System paper trades (user=null) cannot be modified via API
- No sensitive user data is exposed
- Only aggregated performance data is shown

## Future Enhancements

Potential improvements:

1. **Historical Charts**: Add P/L charts over time
2. **Filtering Options**: Filter by market type, timeframe, symbol
3. **Comparison View**: Compare different strategies
4. **Export Data**: Download performance CSV
5. **Shareable Links**: Generate shareable performance reports
6. **Leaderboards**: Compare with other bots

## Related Documentation

- [USER_VS_PUBLIC_PAPER_TRADING.md](USER_VS_PUBLIC_PAPER_TRADING.md) - User-specific vs public routes
- [API_QUICK_REFERENCE.md](API_QUICK_REFERENCE.md) - All API endpoints
- [REAL_TIME_PAPER_TRADING.md](REAL_TIME_PAPER_TRADING.md) - Real-time price features
- [AUTO_TRADING_IMPLEMENTATION_COMPLETE.md](AUTO_TRADING_IMPLEMENTATION_COMPLETE.md) - User auto-trading

## Conclusion

This system provides **complete transparency** of your bot's performance by:

1. ‚úÖ Automatically tracking every signal
2. ‚úÖ Creating real paper trades (not simulated data)
3. ‚úÖ Displaying results publicly without authentication
4. ‚úÖ Updating in real-time with live prices
5. ‚úÖ Showing honest win/loss statistics

Users can visit `/bot-performance` to see your bot's actual performance and decide if they want to use it!
